{"version":3,"file":"visual-search.min.js","mappings":"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","sources":["webpack://cloudinary-video-player/./plugins/visual-search/components/SearchButton.js","webpack://cloudinary-video-player/./plugins/visual-search/visual-search.js","webpack://cloudinary-video-player/./plugins/visual-search/components/SearchResults.js","webpack://cloudinary-video-player/./plugins/visual-search/components/SearchInput.js"],"sourcesContent":["import videojs from 'video.js';\n\nexport const SearchButton = onClick => {\n  const button = videojs.dom.createEl('button', {\n    className: 'vjs-control vjs-button vjs-visual-search-button',\n    title: 'Search video content',\n    ariaLabel: 'Search video content'\n  });\n\n  const searchIcon = videojs.dom.createEl('span', {\n    className: 'vjs-icon-search'\n  });\n  button.appendChild(searchIcon);\n\n  const spinnerIcon = videojs.dom.createEl('span', {\n    className: 'vjs-loading-spinner'\n  });\n  button.appendChild(spinnerIcon);\n\n  button.addEventListener('click', onClick);\n\n  return button;\n};\n","import videojs from 'video.js';\nimport { SearchButton } from './components/SearchButton';\nimport { SearchInput } from './components/SearchInput';\nimport { SearchResults } from './components/SearchResults';\n\nimport './visual-search.scss';\n\nconst visualSearch = (options, player) => {\n  player.addClass('vjs-visual-search');\n\n  let isSearchActive = false;\n\n  const searchResults = SearchResults(player);\n\n  const performSearch = async query => {\n    const searchButton = player.$('.vjs-visual-search-button');\n    searchButton.classList.add('vjs-waiting');\n\n    try {\n      const source = player.cloudinary.source();\n      const publicId = source.publicId();\n      const transformation = Object.assign({}, source.transformation());\n\n      transformation.flags = transformation.flags || [];\n      transformation.flags.push(`getinfo:search_b64_${btoa(query)}`);\n\n      const visualSearchSrc = source.config().url(`${publicId}`, { transformation });\n\n      const response = await fetch(visualSearchSrc, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error(`Search request failed with status: ${response.status}`);\n      }\n\n      const results = await response.json();\n      searchResults.displayResults(results.timestamps);\n\n      if (results && !player.hasStarted()) {\n        // Make sure the progress bar is visible\n        player.play().then(() => player.pause());\n      }\n    } catch (error) {\n      console.error('Error performing visual search:', error);\n    } finally {\n      searchButton.classList.remove('vjs-waiting');\n    }\n  };\n\n  const clearUI = () => {\n    isSearchActive = false;\n    searchResults.clearMarkers();\n    player.$('.vjs-visual-search-wrapper')?.remove();\n  };\n\n  const createSearchUI = () => {\n    clearUI();\n\n    const titleBar = player.$('.vjs-title-bar');\n    if (titleBar) {\n      titleBar.classList.remove('vjs-hidden');\n    }\n\n    const searchContainer = videojs.dom.createEl('div', {\n      className: 'vjs-visual-search-wrapper'\n    });\n\n    // Handle the search icon click (expand or submit)\n    const handleSearchButtonClick = () => {\n      if (!isSearchActive) {\n        isSearchActive = true;\n        searchContainer.classList.add('vjs-visual-search-active');\n        searchInput.input.tabIndex = 0;\n        searchInput.closeButton.tabIndex = 0;\n        searchInput.input.focus();\n      } else {\n        const query = searchInput.input.value.trim();\n        if (query) {\n          performSearch(query);\n        }\n      }\n    };\n\n    const closeSearch = () => {\n      if (isSearchActive) {\n        isSearchActive = false;\n        searchContainer.classList.remove('vjs-visual-search-active');\n        searchInput.input.value = '';\n        searchInput.input.tabIndex = -1;\n        searchInput.closeButton.tabIndex = -1;\n\n        searchResults.clearMarkers();\n      }\n    };\n\n    const searchButton = SearchButton(handleSearchButtonClick);\n    const searchInput = SearchInput(performSearch, closeSearch);\n    searchContainer.appendChild(searchButton);\n    searchContainer.appendChild(searchInput.element);\n\n    titleBar.prepend(searchContainer);\n\n    player.on('keydown', e => {\n      if (e.key === 'Escape' && isSearchActive) {\n        closeSearch();\n      }\n    });\n  };\n\n  createSearchUI();\n\n  // Public methods\n  player.visualSearch = {\n    createSearchUI,\n    clearUI\n  };\n};\n\nexport default visualSearch;\n","import videojs from 'video.js';\n\nexport const SearchResults = player => {\n  const clearMarkers = () => {\n    player.$$('.vjs-visual-search-marker').forEach(el => el.remove());\n    player.$$('.vjs-visual-search-results-wrapper').forEach(el => el.remove());\n\n    // Remove the class that indicates search results are displayed\n    player.removeClass('vjs-visual-search-results-active');\n  };\n\n  const displayResults = results => {\n    // Clear existing markers\n    clearMarkers();\n\n    const total = player.duration();\n    const seekBar = player.controlBar.progressControl.seekBar;\n\n    // Create wrapper for search results\n    const wrapperEl = videojs.dom.createEl('div', {\n      className: 'vjs-visual-search-results-wrapper',\n      role: 'presentation'\n    });\n\n    // Add markers for each result\n    results.forEach(result => {\n      const { start_time, end_time } = result;\n      const position = (start_time / total) * 100;\n      const width = ((end_time - start_time) / total) * 100;\n      const time = `${Math.floor(start_time / 60)}:${Math.floor(start_time % 60)\n        .toString()\n        .padStart(2, '0')}`;\n\n      const markerEl = videojs.dom.createEl('div', {\n        className: 'vjs-control vjs-visual-search-marker',\n        style: `left: ${position}%; width: ${width}%`,\n        tabIndex: 0,\n        role: 'button',\n        title: `Search result at ${time}`,\n        ariaLabel: `Search result at ${time}`\n      });\n\n      wrapperEl.appendChild(markerEl);\n\n      // Add click handler to jump to this time\n      markerEl.addEventListener('click', () => {\n        player.currentTime(start_time);\n      });\n\n      // Add keyboard support\n      markerEl.addEventListener('keydown', e => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          player.currentTime(start_time);\n        }\n      });\n    });\n\n    // Add wrapper to seek bar\n    seekBar.el().appendChild(wrapperEl);\n\n    // Add a class to indicate search results are displayed\n    if (results.length > 0) {\n      player.addClass('vjs-visual-search-results-active');\n    }\n  };\n\n  return {\n    displayResults,\n    clearMarkers\n  };\n};\n","import videojs from 'video.js';\n\nexport const SearchInput = (onSearch, onClose) => {\n  const form = videojs.dom.createEl('form', {\n    className: 'vjs-visual-search-form'\n  });\n\n  const input = videojs.dom.createEl('input', {\n    className: 'vjs-visual-search-input',\n    type: 'text',\n    ariaLabel: 'Search input',\n    tabIndex: -1\n  });\n\n  const closeButton = videojs.dom.createEl('button', {\n    className: 'vjs-control vjs-button vjs-visual-search-close',\n    type: 'button',\n    title: 'Close search',\n    ariaLabel: 'Close search',\n    tabIndex: -1\n  });\n\n  // Add close icon\n  const closeIcon = videojs.dom.createEl('span', {\n    className: 'vjs-icon-close'\n  });\n  closeButton.appendChild(closeIcon);\n\n  form.appendChild(input);\n  form.appendChild(closeButton);\n\n  // Handle search submission\n  form.addEventListener('submit', e => {\n    e.preventDefault();\n    const query = input.value.trim();\n    if (query) {\n      onSearch(query);\n    }\n  });\n\n  // Handle close button\n  closeButton.addEventListener('click', e => {\n    e.preventDefault();\n    if (onClose) {\n      onClose();\n    }\n  });\n\n  return {\n    element: form,\n    input,\n    closeButton\n  };\n};\n"],"names":["visualSearch","options","player","addClass","isSearchActive","searchResults","clearMarkers","$$","forEach","el","remove","removeClass","displayResults","results","total","duration","seekBar","controlBar","progressControl","wrapperEl","videojs","dom","createEl","className","role","result","start_time","end_time","position","width","time","Math","floor","toString","padStart","markerEl","style","tabIndex","title","ariaLabel","appendChild","addEventListener","currentTime","e","key","preventDefault","length","SearchResults","performSearch","async","searchButton","$","classList","add","source","cloudinary","publicId","transformation","Object","assign","flags","push","btoa","query","visualSearchSrc","config","url","response","fetch","method","headers","ok","Error","status","json","timestamps","hasStarted","play","then","pause","error","console","clearUI","createSearchUI","titleBar","searchContainer","closeSearch","searchInput","input","value","closeButton","onClick","button","searchIcon","spinnerIcon","SearchButton","handleSearchButtonClick","trim","focus","SearchInput","onSearch","onClose","form","type","closeIcon","element","prepend","on"],"sourceRoot":""}