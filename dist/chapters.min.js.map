{"version":3,"file":"chapters.min.js","mappings":"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","sources":["webpack://cloudinary-video-player/./plugins/chapters/chapters.js"],"sourcesContent":["import videojs from 'video.js';\n\nimport './chapters.scss';\nimport { extendCloudinaryConfig, getCloudinaryUrl } from '../cloudinary/common';\n\n/**\n * Chapters plugin.\n *\n * @function chapters\n * @param    {Object} [options={}]\n *           An object of options left to the plugin author to define.\n * @param    {Player} player\n *           A Video.js player object.\n */\nconst chapters = function chapters(options, player) {\n  player.addClass('vjs-chapters');\n  player.chapters = new ChaptersPlugin(player, options);\n};\n\n/**\n * Chapters\n */\nconst ChaptersPlugin = (function () {\n  /**\n   * Plugin class constructor, called by videojs on\n   * ready event.\n   *\n   * @function  constructor\n   * @param    {Player} player\n   *           A Video.js player object.\n   *\n   * @param    {Object} [options={}]\n   *           A plain object containing options for the plugin.\n   */\n  function ChaptersPlugin(player, options) {\n    this.player = player;\n    this.options = options;\n    this.player.one('loadedmetadata', this.initializeChapters.bind(this));\n    return this;\n  }\n\n  ChaptersPlugin.prototype.src = function src(options) {\n    this.resetPlugin();\n    this.options = options;\n    this.player.one('loadedmetadata', this.initializeChapters.bind(this));\n  };\n\n  ChaptersPlugin.prototype.detach = function detach() {\n    this.resetPlugin();\n  };\n\n  ChaptersPlugin.prototype.resetPlugin = function resetPlugin() {\n    if (this.chaptersTrack) {\n      this.player.$('.vjs-control-bar-chapter-display').remove();\n      this.player.$('.vjs-chapter-display').remove();\n      this.player.$$('.vjs-chapter-marker').forEach(el => el.remove());\n      this.player.removeRemoteTextTrack(this.chaptersTrack);\n      delete this.chaptersTrack;\n    }\n  };\n\n  ChaptersPlugin.prototype.getChaptersFileUrlByName = function getChaptersFileUrlByName() {\n    const currentPublicId = this.player.cloudinary.currentPublicId();\n\n    if (!currentPublicId) {\n      return null;\n    }\n\n    const fullUrl = getCloudinaryUrl(\n      `${currentPublicId}-chapters.vtt`,\n      extendCloudinaryConfig(this.player.cloudinary.cloudinaryConfig(), {\n        resource_type: 'raw',\n        version: '1'\n      })\n    );\n    return `${fullUrl}?t=${Date.now()}`;\n  };\n\n  /**\n   * Bootstrap the plugin.\n   */\n  ChaptersPlugin.prototype.initializeChapters = async function initializeChapters() {\n    const chaptersUrl = this.options === true ? this.getChaptersFileUrlByName() : this.options.url;\n\n    if (chaptersUrl) {\n      // Fetch chapters VTT from URL\n      const chaptersTrack = {\n        kind: 'chapters',\n        src: chaptersUrl,\n        default: true\n      };\n      const textTrack = this.player.addRemoteTextTrack(chaptersTrack);\n\n      textTrack.addEventListener('load', () => {\n        this.chaptersTrack = textTrack.track;\n        this.setupChaptersDisplays();\n      });\n    } else if (Object.entries(this.options).length) {\n      // Setup chapters from options\n      const textTrack = this.player.addRemoteTextTrack({\n        kind: 'chapters',\n        default: true\n      });\n\n      const end = this.player.duration();\n      Object.entries(this.options).forEach((entry, index, arr) => {\n        const cue = new VTTCue(\n          parseFloat(entry[0]),\n          parseFloat(arr[index + 1] ? arr[index + 1][0] : end),\n          entry[1]\n        );\n        textTrack.track.addCue(cue);\n      });\n\n      this.chaptersTrack = textTrack.track;\n      this.setupChaptersDisplays();\n      if (this.player.controlBar.chaptersButton) {\n        this.player.controlBar.chaptersButton.update();\n      }\n    }\n  };\n\n  /**\n   * Setup chapter displays.\n   */\n  ChaptersPlugin.prototype.setupChaptersDisplays = function initializeChapters() {\n    this.setupProgressBarMarkers();\n    this.setupProgressBarChapter();\n    this.setupControlBarChapter();\n  };\n\n  /**\n   * Setup the controlbar chapter display.\n   */\n  ChaptersPlugin.prototype.setupControlBarChapter = function setupControlBarChapter() {\n    const controlBarChapterHolder =\n      this.player.$('.vjs-control-bar-chapter-display') || document.createElement('div');\n    controlBarChapterHolder.setAttribute('class', 'vjs-control-bar-chapter-display');\n\n    const wrapper = this.player.$('.vjs-control-bar .vjs-spacer');\n    wrapper.innerHTML = '';\n    wrapper.classList.add('vjs-control-bar-chapter-wrapper');\n    wrapper.appendChild(controlBarChapterHolder);\n\n    this.chaptersTrack.addEventListener('cuechange', () => {\n      const activeCues = Array.from(this.chaptersTrack.activeCues); // Safari needs Array.from()\n      controlBarChapterHolder.innerText = activeCues.length > 0 ? activeCues[0].text : '';\n    });\n  };\n\n  /**\n   * Setup the progress bar markers.\n   */\n  ChaptersPlugin.prototype.setupProgressBarMarkers = function setupProgressBarMarkers() {\n    const total = this.player.duration();\n    const { seekBar } = this.player.controlBar.progressControl;\n\n    Array.from(this.chaptersTrack.cues).forEach(marker => {\n      // Safari needs Array.from()\n      if (marker.startTime !== 0) {\n        const markerTime = marker.startTime;\n        const left = (markerTime / total) * 100 + '%';\n\n        const markerEl = videojs.dom.createEl('div', undefined, {\n          class: 'vjs-chapter-marker',\n          style: `left: ${left}`\n        });\n\n        seekBar.el().append(markerEl);\n      }\n    });\n  };\n\n  /**\n   * Setup the progrees bar on-hover chapter display.\n   */\n  ChaptersPlugin.prototype.setupProgressBarChapter = function setupProgressBarChapter() {\n    const chapterEl = videojs.dom.createEl('div', undefined, {\n      class: 'vjs-chapter-display',\n      style: `max-width: ${this.player.$('.vjs-vtt-thumbnail-display') ? this.player.$('.vjs-vtt-thumbnail-display').style.width : '160px'}`\n    });\n\n    const mouseTimeDisplay = this.player.getDescendant([\n      'controlBar',\n      'progressControl',\n      'seekBar',\n      'mouseTimeDisplay'\n    ]);\n    const timeTooltip = mouseTimeDisplay.getDescendant(['timeTooltip']);\n\n    timeTooltip.el().parentElement.prepend(chapterEl);\n\n    const getChapterFromPoint = point => {\n      const total = this.player.duration();\n      const seekBarTime = point * total;\n      const chapter = Array.from(this.chaptersTrack?.cues || []).find(marker => {\n        return seekBarTime >= marker.startTime && seekBarTime <= marker.endTime;\n      });\n      return chapter ? chapter.text : '';\n    };\n\n    timeTooltip.update = function (seekBarRect, seekBarPoint, content) {\n      const originalUpdateFn = Object.getPrototypeOf(this).update;\n      originalUpdateFn.call(this, seekBarRect, seekBarPoint, content);\n      chapterEl.innerText = getChapterFromPoint(seekBarPoint);\n    };\n\n    // Handle case of no seek-thumbnails\n    if (typeof this.player.vttThumbnails !== 'object') {\n      mouseTimeDisplay.update = function (seekBarRect, seekBarPoint) {\n        const time = seekBarPoint * this.player_.duration();\n        const width = seekBarRect.width;\n        const size = chapterEl.clientWidth / 2;\n\n        timeTooltip.updateTime(seekBarRect, seekBarPoint, time, () => {\n          // Make sure it doesn't exit the player\n          if (seekBarRect.width * seekBarPoint < size) {\n            this.el_.style.left = `${size}px`;\n          } else if (seekBarRect.width * seekBarPoint + size > width) {\n            this.el_.style.left = `${seekBarRect.width - size}px`;\n          } else {\n            this.el_.style.left = `${seekBarRect.width * seekBarPoint}px`;\n          }\n        });\n        timeTooltip.write(videojs.time.formatTime(time));\n      };\n    }\n  };\n\n  return ChaptersPlugin;\n})();\n\nexport default chapters;\n"],"names":["ChaptersPlugin","player","options","this","one","initializeChapters","bind","prototype","src","resetPlugin","detach","chaptersTrack","$","remove","$$","forEach","el","removeRemoteTextTrack","getChaptersFileUrlByName","currentPublicId","cloudinary","getCloudinaryUrl","extendCloudinaryConfig","cloudinaryConfig","resource_type","version","Date","now","async","chaptersUrl","url","kind","default","textTrack","addRemoteTextTrack","addEventListener","track","setupChaptersDisplays","Object","entries","length","end","duration","entry","index","arr","cue","VTTCue","parseFloat","addCue","controlBar","chaptersButton","update","setupProgressBarMarkers","setupProgressBarChapter","setupControlBarChapter","controlBarChapterHolder","document","createElement","setAttribute","wrapper","innerHTML","classList","add","appendChild","activeCues","Array","from","innerText","text","total","seekBar","progressControl","cues","marker","startTime","left","markerEl","videojs","dom","createEl","undefined","class","style","append","chapterEl","width","mouseTimeDisplay","getDescendant","timeTooltip","parentElement","prepend","getChapterFromPoint","point","seekBarTime","chapter","find","endTime","seekBarRect","seekBarPoint","content","getPrototypeOf","call","vttThumbnails","time","player_","size","clientWidth","updateTime","el_","write","formatTime","addClass","chapters"],"sourceRoot":""}